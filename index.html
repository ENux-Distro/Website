<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Focus & Flow | Daily Planner</title>
    
    <!-- 1. Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- 3. Babel (to interpret JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 4. Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        /* Custom styling for time inputs */
        input[type="time"]::-webkit-calendar-picker-indicator {
            filter: invert(0.5);
            cursor: pointer;
        }
        
        /* Modern Focus Glow */
        .timer-active {
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.15);
            border-color: rgba(99, 102, 241, 0.4);
        }

        /* Small animations */
        .task-enter { animation: slideIn 0.3s ease-out; }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Icons (Scaled to 18px for better visual balance) ---
        const Icons = {
            Zap: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
            BatteryLow: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="2" y="7" width="16" height="10" rx="2" ry="2"/><line x1="22" y1="11" x2="22" y2="13"/><line x1="6" y1="11" x2="6" y2="13"/></svg>,
            BatteryMedium: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="2" y="7" width="16" height="10" rx="2" ry="2"/><line x1="22" y1="11" x2="22" y2="13"/><line x1="6" y1="11" x2="10" y2="11"/><line x1="6" y1="13" x2="10" y2="13"/></svg>,
            BatteryFull: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="2" y="7" width="16" height="10" rx="2" ry="2"/><line x1="22" y1="11" x2="22" y2="13"/><line x1="6" y1="11" x2="14" y2="11"/><line x1="6" y1="13" x2="14" y2="13"/></svg>,
            Dumbbell: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m6.5 6.5 11 11"/><path d="m21 21-1-1"/><path d="m3 3 1 1"/><path d="m18 22 4-4"/><path d="m2 6 4-4"/><path d="m3 10 7-7"/><path d="m14 21 7-7"/></svg>,
            Play: () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3"/></svg>,
            Square: () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/></svg>,
            CheckCircle: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>,
            Plus: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>,
            Trash: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>
        };

        // --- Helpers ---
        const generateId = () => Math.random().toString(36).substr(2, 9);
        const format12h = (time24) => {
            if (!time24) return '';
            const [hrs, mins] = time24.split(':');
            const h = parseInt(hrs);
            const suffix = h >= 12 ? 'PM' : 'AM';
            const h12 = ((h + 11) % 12 + 1);
            return `${h12}:${mins} ${suffix}`;
        };

        const defaultTasks = [
          { id: '1', time: '08:00', title: 'Wake up & Hydrate', completed: false, duration: 30 },
          { id: '2', time: '09:00', title: 'Deep Work Session', completed: false, duration: 90 },
          { id: '3', time: '12:30', title: 'Healthy Lunch', completed: false, duration: 60 },
          { id: '4', time: '18:00', title: 'Wind Down', completed: false, duration: 60 },
        ];

        const workoutTasks = [
          { id: 'w1', time: '07:30', title: 'Morning Jog / HIIT', completed: false, type: 'health', duration: 30 },
          { id: 'w2', time: '17:30', title: 'Gym Session', completed: false, type: 'health', duration: 60 },
        ];

        const lightMovementTasks = [
          { id: 'l1', time: '07:45', title: 'Light Stretching', completed: false, type: 'health', duration: 15 },
          { id: 'l2', time: '15:00', title: '10-min Walk', completed: false, type: 'health', duration: 10 },
        ];

        function App() {
            // Load state from LocalStorage on init
            const [plan, setPlan] = useState(() => {
                const saved = localStorage.getItem('daily_planner_data');
                return saved ? JSON.parse(saved) : {
                    tasks: defaultTasks,
                    energyLevel: 'medium',
                    workoutMode: false
                };
            });

            const [activeTimer, setActiveTimer] = useState(null);
            const [timeLeft, setTimeLeft] = useState(0);
            const [isTimerRunning, setIsTimerRunning] = useState(false);
            const timerRef = useRef(null);

            // Save to LocalStorage whenever plan changes
            useEffect(() => {
                localStorage.setItem('daily_planner_data', JSON.stringify(plan));
            }, [plan]);

            // Timer Tick Logic
            useEffect(() => {
                if (isTimerRunning && timeLeft > 0) {
                    timerRef.current = setTimeout(() => setTimeLeft(p => p - 1), 1000);
                } else if (timeLeft === 0 && isTimerRunning) {
                    setIsTimerRunning(false);
                    // Simple notification if possible
                    if ("Notification" in window && Notification.permission === "granted") {
                        new Notification("Time's up!", { body: "Your focus session is complete." });
                    }
                }
                return () => clearTimeout(timerRef.current);
            }, [timeLeft, isTimerRunning]);

            // Handlers
            const toggleTask = (id) => {
                setPlan(prev => ({
                    ...prev,
                    tasks: prev.tasks.map(t => t.id === id ? { ...t, completed: !t.completed } : t)
                }));
            };

            const deleteTask = (id) => {
                setPlan(prev => ({
                    ...prev,
                    tasks: prev.tasks.filter(t => t.id !== id)
                }));
            };

            const addTask = () => {
                const newTask = { id: generateId(), time: '12:00', title: 'New Task', completed: false, duration: 30 };
                const newTasks = [...plan.tasks, newTask].sort((a, b) => a.time.localeCompare(b.time));
                setPlan({ ...plan, tasks: newTasks });
            };

            const startTimer = (task) => {
                if (activeTimer === task.id && isTimerRunning) {
                    setIsTimerRunning(false);
                } else {
                    setActiveTimer(task.id);
                    setTimeLeft((task.duration || 30) * 60);
                    setIsTimerRunning(true);
                    // Request notification permission
                    if ("Notification" in window && Notification.permission === "default") {
                        Notification.requestPermission();
                    }
                }
            };

            const getCompletion = () => {
                if (!plan.tasks.length) return 0;
                return Math.round((plan.tasks.filter(t => t.completed).length / plan.tasks.length) * 100);
            };

            return (
                <div className="min-h-screen pb-12 bg-slate-50">
                    <header className="bg-white border-b border-slate-200 sticky top-0 z-30 px-4 py-3 shadow-sm">
                        <div className="max-w-xl mx-auto flex justify-between items-center">
                            <div>
                                <h1 className="text-lg font-black text-slate-800 flex items-center gap-2">
                                    <span className="text-indigo-600"><Icons.Zap /></span> FOCUS & FLOW
                                </h1>
                                <p className="text-[10px] text-slate-400 uppercase tracking-widest font-bold">Offline Dashboard</p>
                            </div>
                            <div className="flex items-center gap-3">
                                <div className="text-right">
                                    <div className="text-[10px] font-bold text-slate-400 uppercase">Progress</div>
                                    <div className="text-indigo-600 font-black text-sm">{getCompletion()}%</div>
                                </div>
                                <div className="w-8 h-8 rounded-full bg-indigo-50 flex items-center justify-center border-2 border-indigo-100">
                                    <span className="font-bold text-xs text-indigo-600">{plan.tasks.filter(t => t.completed).length}</span>
                                </div>
                            </div>
                        </div>
                    </header>

                    <main className="max-w-xl mx-auto px-4 py-6 space-y-6">
                        
                        {/* Energy & Activity */}
                        <section className="grid grid-cols-2 gap-3">
                            <div className="bg-white p-3 rounded-2xl border border-slate-200 shadow-sm">
                                <label className="block text-[10px] font-bold text-slate-400 uppercase mb-2">Energy</label>
                                <div className="flex gap-1 bg-slate-50 p-1 rounded-xl">
                                    {['low', 'medium', 'high'].map(l => (
                                        <button 
                                            key={l} 
                                            onClick={() => setPlan({...plan, energyLevel: l})} 
                                            className={`flex-1 py-1.5 rounded-lg flex justify-center transition-all ${plan.energyLevel === l ? 'bg-white shadow-sm ring-1 ring-slate-200 text-indigo-600' : 'text-slate-300'}`}
                                        >
                                            {l === 'low' ? <Icons.BatteryLow /> : l === 'medium' ? <Icons.BatteryMedium /> : <Icons.BatteryFull />}
                                        </button>
                                    ))}
                                </div>
                            </div>
                            
                            <button 
                                onClick={() => {
                                    const newMode = !plan.workoutMode;
                                    let tasks = plan.tasks.filter(t => !['w1', 'w2', 'l1', 'l2'].includes(t.id));
                                    if (newMode) tasks.push(...workoutTasks); 
                                    else tasks.push(...lightMovementTasks);
                                    setPlan({...plan, workoutMode: newMode, tasks: tasks.sort((a,b) => a.time.localeCompare(b.time))});
                                }} 
                                className={`p-3 rounded-2xl border transition-all flex flex-col justify-between text-left ${plan.workoutMode ? 'bg-emerald-50 border-emerald-200 text-emerald-700' : 'bg-white border-slate-200 text-slate-400 shadow-sm'}`}
                            >
                                <label className="block text-[10px] font-bold uppercase opacity-60">Fitness Mode</label>
                                <div className="flex items-center justify-between mt-1">
                                    <span className="font-bold text-sm">{plan.workoutMode ? 'Active' : 'Rest'}</span>
                                    <Icons.Dumbbell />
                                </div>
                            </button>
                        </section>

                        {/* Timeline */}
                        <section className="space-y-3">
                            <div className="flex justify-between items-center px-1">
                                <h2 className="text-xs font-bold text-slate-400 uppercase tracking-wider">Timeline</h2>
                                <button onClick={addTask} className="text-xs text-indigo-600 font-bold hover:underline opacity-80">+ Add Goal</button>
                            </div>
                            
                            <div className="space-y-2.5">
                                {plan.tasks.map((task, idx) => (
                                    <div 
                                        key={task.id} 
                                        className={`task-enter group flex items-center gap-3 p-3.5 rounded-2xl border transition-all ${task.completed ? 'bg-slate-50 border-slate-100 opacity-50' : (activeTimer === task.id && isTimerRunning ? 'bg-white timer-active ring-2 ring-indigo-500/10' : 'bg-white border-slate-200 shadow-sm')}`}
                                    >
                                        {/* Time Logic with AM/PM view */}
                                        <div className="flex flex-col items-center min-w-[70px] border-r border-slate-100 pr-2">
                                            <input 
                                                type="time" 
                                                value={task.time} 
                                                onChange={(e) => {
                                                    const ts = [...plan.tasks]; 
                                                    ts[idx].time = e.target.value;
                                                    setPlan({...plan, tasks: ts.sort((a,b) => a.time.localeCompare(b.time))});
                                                }} 
                                                className="bg-transparent text-[11px] font-black text-indigo-600 focus:outline-none w-full text-center" 
                                            />
                                            <div className="text-[9px] font-bold text-slate-400 leading-none mt-1">{format12h(task.time)}</div>
                                        </div>

                                        {/* Completion Toggle */}
                                        <button 
                                            onClick={() => toggleTask(task.id)} 
                                            className={`transition-all active:scale-90 ${task.completed ? 'text-emerald-500' : 'text-slate-200 hover:text-indigo-400'}`}
                                        >
                                            <Icons.CheckCircle />
                                        </button>

                                        {/* Content */}
                                        <div className="flex-grow">
                                            <input 
                                                type="text" 
                                                value={task.title} 
                                                onChange={(e) => {
                                                    const ts = [...plan.tasks]; 
                                                    ts[idx].title = e.target.value;
                                                    setPlan({...plan, tasks: ts});
                                                }} 
                                                className={`bg-transparent w-full text-sm font-semibold focus:outline-none ${task.completed ? 'line-through text-slate-400' : 'text-slate-700'}`} 
                                            />
                                            
                                            {!task.completed && (
                                                <div className="flex items-center gap-2 mt-1.5">
                                                    <button 
                                                        onClick={() => startTimer(task)} 
                                                        className={`flex items-center gap-1.5 text-[9px] font-black uppercase px-2.5 py-1 rounded-lg transition-colors ${activeTimer === task.id && isTimerRunning ? 'bg-red-500 text-white shadow-sm' : 'bg-indigo-50 text-indigo-600'}`}
                                                    >
                                                        {activeTimer === task.id && isTimerRunning ? <Icons.Square /> : <Icons.Play />}
                                                        {activeTimer === task.id ? `${Math.floor(timeLeft/60)}:${(timeLeft%60).toString().padStart(2,'0')}` : `${task.duration || 30}m Focus`}
                                                    </button>
                                                </div>
                                            )}
                                        </div>

                                        {/* Delete */}
                                        <button 
                                            onClick={() => deleteTask(task.id)} 
                                            className="opacity-0 group-hover:opacity-100 p-1 text-slate-300 hover:text-red-400 transition-all active:scale-90"
                                        >
                                            <Icons.Trash />
                                        </button>
                                    </div>
                                ))}
                            </div>
                        </section>

                        {/* Reset Options */}
                        <div className="pt-4 flex justify-center">
                            <button 
                                onClick={() => {
                                    if(confirm("Reset all tasks for today?")) {
                                        setPlan({ tasks: defaultTasks, energyLevel: 'medium', workoutMode: false });
                                    }
                                }} 
                                className="text-[10px] font-bold text-slate-400 uppercase hover:text-slate-600"
                            >
                                Reset Daily Protocol
                            </button>
                        </div>
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
